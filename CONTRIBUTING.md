# Contributing to TENJIN

TENJINæ•™è‚²ç†è«–GraphRAG MCPã‚µãƒ¼ãƒãƒ¼ã¸ã®è²¢çŒ®ã‚’æ­“è¿ã—ã¾ã™ï¼

## ç›®æ¬¡

- [è¡Œå‹•è¦ç¯„](#è¡Œå‹•è¦ç¯„)
- [è²¢çŒ®ã®æ–¹æ³•](#è²¢çŒ®ã®æ–¹æ³•)
- [é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
- [ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„](#ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„)
- [ãƒ†ã‚¹ãƒˆ](#ãƒ†ã‚¹ãƒˆ)
- [ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ](#ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ)
- [æ•™è‚²ç†è«–ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ ](#æ•™è‚²ç†è«–ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ )

---

## è¡Œå‹•è¦ç¯„

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ã™ã¹ã¦ã®å‚åŠ è€…ã«å¯¾ã—ã¦æ•¬æ„ã‚’æŒã£ãŸå»ºè¨­çš„ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ±‚ã‚ã¾ã™ã€‚æ•™è‚²ã«é–¢ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã€å­¦ç¿’ã¨æˆé•·ã‚’ä¿ƒé€²ã™ã‚‹ç’°å¢ƒã‚’ç¶­æŒã—ã¾ã™ã€‚

---

## è²¢çŒ®ã®æ–¹æ³•

### 1. ãƒã‚°å ±å‘Š

ãƒã‚°ã‚’ç™ºè¦‹ã—ãŸå ´åˆã¯ã€GitHub Issueã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š

- **ã‚¿ã‚¤ãƒˆãƒ«**: ç°¡æ½”ã§æ˜ç¢ºãªèª¬æ˜
- **ç’°å¢ƒ**: OSã€Pythonãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ä¾å­˜é–¢ä¿‚ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³
- **å†ç¾æ‰‹é †**: ãƒã‚°ã‚’å†ç¾ã™ã‚‹ãŸã‚ã®å…·ä½“çš„ãªæ‰‹é †
- **æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ**: æœ¬æ¥ã©ã†å‹•ä½œã™ã¹ãã‹
- **å®Ÿéš›ã®å‹•ä½œ**: å®Ÿéš›ã«ä½•ãŒèµ·ã“ã£ãŸã‹
- **ãƒ­ã‚°ãƒ»ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ**: é–¢é€£ã™ã‚‹æƒ…å ±

### 2. æ©Ÿèƒ½ææ¡ˆ

æ–°æ©Ÿèƒ½ã®ã‚¢ã‚¤ãƒ‡ã‚¢ãŒã‚ã‚‹å ´åˆï¼š

- **ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹**: ã©ã®ã‚ˆã†ãªå•é¡Œã‚’è§£æ±ºã™ã‚‹ã‹
- **ææ¡ˆã™ã‚‹è§£æ±ºç­–**: å…·ä½“çš„ãªå®Ÿè£…æ¡ˆ
- **ä»£æ›¿æ¡ˆ**: æ¤œè¨ã—ãŸä»–ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
- **å½±éŸ¿ç¯„å›²**: æ—¢å­˜æ©Ÿèƒ½ã¸ã®å½±éŸ¿

### 3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ”¹å–„

- èª¤å­—ãƒ»è„±å­—ã®ä¿®æ­£
- èª¬æ˜ã®æ˜ç¢ºåŒ–
- ä½¿ç”¨ä¾‹ã®è¿½åŠ 
- ç¿»è¨³ã®è¿½åŠ ãƒ»æ”¹å–„

### 4. ã‚³ãƒ¼ãƒ‰è²¢çŒ®

- ãƒã‚°ä¿®æ­£
- æ–°æ©Ÿèƒ½ã®å®Ÿè£…
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
- ãƒ†ã‚¹ãƒˆã®è¿½åŠ 

---

## é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

- Python 3.11ä»¥ä¸Š
- Docker & Docker Compose
- Git

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

```bash
# ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone https://github.com/your-org/tenjin.git
cd tenjin

# ä»®æƒ³ç’°å¢ƒã‚’ä½œæˆ
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

# é–‹ç™ºç”¨ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -e ".[dev]"

# pre-commitãƒ•ãƒƒã‚¯ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pre-commit install

# Neo4jã‚’èµ·å‹•
docker-compose up -d neo4j

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰
python scripts/load_data.py

# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
pytest
```

### IDEè¨­å®š

#### VS Code

æ¨å¥¨æ‹¡å¼µæ©Ÿèƒ½:
- Python (ms-python.python)
- Pylance (ms-python.vscode-pylance)
- Black Formatter (ms-python.black-formatter)
- Ruff (charliermarsh.ruff)

`.vscode/settings.json`:
```json
{
    "python.defaultInterpreterPath": "${workspaceFolder}/.venv/bin/python",
    "python.analysis.typeCheckingMode": "basic",
    "editor.formatOnSave": true,
    "python.formatting.provider": "black",
    "[python]": {
        "editor.defaultFormatter": "ms-python.black-formatter"
    }
}
```

---

## ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

### Python ã‚¹ã‚¿ã‚¤ãƒ«

- **ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼**: Black (line-length: 88)
- **ãƒªãƒ³ã‚¿ãƒ¼**: Ruff
- **å‹ãƒã‚§ãƒƒã‚¯**: mypy (strict mode)
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: Google style docstrings

```python
def calculate_similarity(
    theory_a: Theory,
    theory_b: Theory,
    *,
    method: str = "cosine",
) -> float:
    """2ã¤ã®ç†è«–é–“ã®é¡ä¼¼åº¦ã‚’è¨ˆç®—ã™ã‚‹ã€‚

    Args:
        theory_a: æ¯”è¼ƒå…ƒã®ç†è«–
        theory_b: æ¯”è¼ƒå…ˆã®ç†è«–
        method: é¡ä¼¼åº¦è¨ˆç®—æ–¹æ³•ï¼ˆ"cosine", "euclidean", "jaccard"ï¼‰

    Returns:
        0.0ã‹ã‚‰1.0ã®ç¯„å›²ã®é¡ä¼¼åº¦ã‚¹ã‚³ã‚¢

    Raises:
        ValueError: ç„¡åŠ¹ãªãƒ¡ã‚½ãƒƒãƒ‰ãŒæŒ‡å®šã•ã‚ŒãŸå ´åˆ

    Example:
        >>> similarity = calculate_similarity(theory1, theory2)
        >>> print(f"Similarity: {similarity:.2f}")
    """
    if method not in ("cosine", "euclidean", "jaccard"):
        raise ValueError(f"Invalid method: {method}")
    
    # å®Ÿè£…...
    return score
```

### å‘½åè¦ç´„

- **ã‚¯ãƒ©ã‚¹**: PascalCaseï¼ˆ`TheoryService`, `Neo4jAdapter`ï¼‰
- **é–¢æ•°ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰**: snake_caseï¼ˆ`get_theory`, `calculate_similarity`ï¼‰
- **å®šæ•°**: UPPER_SNAKE_CASEï¼ˆ`DEFAULT_TIMEOUT`, `MAX_RESULTS`ï¼‰
- **ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ**: å…ˆé ­ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ï¼ˆ`_internal_method`ï¼‰

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

Clean Architectureã®åŸå‰‡ã«å¾“ã„ã¾ã™ï¼š

1. **Domainå±¤**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã€å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
2. **Applicationå±¤**: ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã€ã‚µãƒ¼ãƒ“ã‚¹
3. **Infrastructureå±¤**: å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
4. **Interfaceå±¤**: MCPã€API

ä¾å­˜é–¢ä¿‚ã®æ–¹å‘:
```
Interface â†’ Application â†’ Domain
Infrastructure â†’ Domain
```

### ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

Conventional Commitsã‚’ä½¿ç”¨ï¼š

```
<type>(<scope>): <description>

[optional body]

[optional footer(s)]
```

ã‚¿ã‚¤ãƒ—:
- `feat`: æ–°æ©Ÿèƒ½
- `fix`: ãƒã‚°ä¿®æ­£
- `docs`: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- `style`: ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç­‰ï¼‰
- `refactor`: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
- `perf`: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
- `test`: ãƒ†ã‚¹ãƒˆè¿½åŠ ãƒ»ä¿®æ­£
- `chore`: ãƒ“ãƒ«ãƒ‰ã€CIç­‰

ä¾‹:
```
feat(search): add hybrid search with graph and vector

Implement hybrid search combining Neo4j graph traversal
with ChromaDB vector similarity for improved results.

Closes #123
```

---

## ãƒ†ã‚¹ãƒˆ

### ãƒ†ã‚¹ãƒˆæ§‹é€ 

```
tests/
â”œâ”€â”€ unit/              # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ test_entities.py
â”‚   â”œâ”€â”€ test_value_objects.py
â”‚   â””â”€â”€ test_services.py
â”œâ”€â”€ integration/       # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ test_neo4j_adapter.py
â”‚   â””â”€â”€ test_mcp_tools.py
â””â”€â”€ e2e/              # E2Eãƒ†ã‚¹ãƒˆ
    â””â”€â”€ test_mcp_server_e2e.py
```

### ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
# ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆ
pytest

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
pytest tests/unit/test_entities.py

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ã
pytest --cov=src/tenjin --cov-report=html

# ä¸¦åˆ—å®Ÿè¡Œ
pytest -n auto

# ç‰¹å®šã®ãƒãƒ¼ã‚«ãƒ¼
pytest -m "not slow"
```

### ãƒ†ã‚¹ãƒˆä½œæˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

```python
import pytest
from tenjin.domain.entities import Theory

class TestTheory:
    """Theoryã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ãƒ†ã‚¹ãƒˆ"""

    def test_create_theory_with_valid_data(
        self,
        sample_theory_data: dict,
    ) -> None:
        """æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã§ç†è«–ã‚’ä½œæˆã§ãã‚‹ã“ã¨ã‚’ç¢ºèª"""
        # Arrange
        data = sample_theory_data

        # Act
        theory = Theory(**data)

        # Assert
        assert theory.id == data["id"]
        assert theory.name == data["name"]

    def test_create_theory_without_required_field_raises_error(self) -> None:
        """å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒãªã„å ´åˆã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ç¢ºèª"""
        with pytest.raises(ValueError):
            Theory(name="Test")  # id missing

    @pytest.mark.parametrize(
        "category,expected",
        [
            ("learning_theory", True),
            ("invalid", False),
        ],
    )
    def test_category_validation(
        self,
        category: str,
        expected: bool,
    ) -> None:
        """ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®æ¤œè¨¼ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹ã“ã¨ã‚’ç¢ºèª"""
        # ...
```

### ã‚«ãƒãƒ¬ãƒƒã‚¸è¦ä»¶

- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ: 80%ä»¥ä¸Š
- çµ±åˆãƒ†ã‚¹ãƒˆ: ä¸»è¦ãªãƒ‘ã‚¹ã‚’ã‚«ãƒãƒ¼
- E2Eãƒ†ã‚¹ãƒˆ: ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

---

## ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

### PRã®ä½œæˆ

1. **ãƒ•ã‚©ãƒ¼ã‚¯ã¨ãƒ–ãƒ©ãƒ³ãƒ**:
   ```bash
   git checkout -b feature/my-feature
   ```

2. **å¤‰æ›´ã‚’å®Ÿè£…**

3. **ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ãƒ»å®Ÿè¡Œ**:
   ```bash
   pytest
   ```

4. **ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°**:
   ```bash
   ruff check src/
   black src/
   mypy src/
   ```

5. **ã‚³ãƒŸãƒƒãƒˆ**:
   ```bash
   git commit -m "feat(search): add new search feature"
   ```

6. **ãƒ—ãƒƒã‚·ãƒ¥**:
   ```bash
   git push origin feature/my-feature
   ```

7. **PRã‚’ä½œæˆ**

### PRãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```markdown
## æ¦‚è¦
<!-- å¤‰æ›´ã®æ¦‚è¦ã‚’è¨˜è¿° -->

## å¤‰æ›´ã®ç¨®é¡
- [ ] ãƒã‚°ä¿®æ­£
- [ ] æ–°æ©Ÿèƒ½
- [ ] ç ´å£Šçš„å¤‰æ›´
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°

## å¤‰æ›´å†…å®¹
<!-- å…·ä½“çš„ãªå¤‰æ›´å†…å®¹ -->

## ãƒ†ã‚¹ãƒˆ
<!-- å®Ÿæ–½ã—ãŸãƒ†ã‚¹ãƒˆã®èª¬æ˜ -->
- [ ] ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
- [ ] æ—¢å­˜ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œç¢ºèª

## ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] ã‚³ãƒ¼ãƒ‰ãŒã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦ã„ã‚‹
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã—ãŸ
- [ ] ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ãŸ
- [ ] ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒãƒ‘ã‚¹ã™ã‚‹

## é–¢é€£Issue
<!-- Closes #123 -->
```

### ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚»ã‚¹

1. CIãƒã‚§ãƒƒã‚¯ãŒãƒ‘ã‚¹
2. å°‘ãªãã¨ã‚‚1äººã®ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‰¿èª
3. ã‚³ãƒ¡ãƒ³ãƒˆã¸ã®å¯¾å¿œ
4. ãƒãƒ¼ã‚¸ï¼ˆsquash mergeæ¨å¥¨ï¼‰

---

## æ•™è‚²ç†è«–ãƒ‡ãƒ¼ã‚¿ã®è¿½åŠ 

### æ–°ã—ã„ç†è«–ã®è¿½åŠ 

1. **theories.jsonã«è¿½åŠ **:

```json
{
  "id": "new_theory",
  "name": "New Theory",
  "name_ja": "æ–°ç†è«–",
  "category": "learning_theory",
  "priority": 4,
  "theorists": ["theorist_name"],
  "description": "English description...",
  "description_ja": "æ—¥æœ¬èªã®èª¬æ˜...",
  "key_principles": [
    "Principle 1",
    "Principle 2"
  ],
  "applications": [
    "Application 1"
  ],
  "strengths": [
    "Strength 1"
  ],
  "limitations": [
    "Limitation 1"
  ]
}
```

2. **theorists.jsonã«è¿½åŠ **ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰:

```json
{
  "id": "theorist_name",
  "name": "Theorist Name",
  "name_ja": "ç†è«–å®¶ã®åå‰",
  "birth_year": 1900,
  "death_year": 2000,
  "nationality": "Country",
  "biography": "Biography...",
  "biography_ja": "çµŒæ­´...",
  "major_works": [
    {"title": "Work Title", "year": 1950}
  ]
}
```

3. **relationships.jsonã«è¿½åŠ **:

```json
{
  "source": "new_theory",
  "target": "existing_theory",
  "type": "extends",
  "description": "Description of relationship"
}
```

### ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®è¿½åŠ 

1. **categories.jsonã«è¿½åŠ **:

```json
{
  "id": "new_category",
  "name": "New Category",
  "name_ja": "æ–°ã‚«ãƒ†ã‚´ãƒªãƒ¼",
  "description": "Description...",
  "description_ja": "èª¬æ˜..."
}
```

2. **CategoryTypeåˆ—æŒ™å‹ã‚’æ›´æ–°**ï¼ˆ`value_objects.py`ï¼‰

### ãƒ‡ãƒ¼ã‚¿å“è³ªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] æ—¥æœ¬èªã¨è‹±èªã®ä¸¡æ–¹ã®èª¬æ˜
- [ ] æ­£ç¢ºãªæ­´å²çš„æƒ…å ±
- [ ] é©åˆ‡ãªé–¢é€£ç†è«–ã¨ã®ãƒªãƒ³ã‚¯
- [ ] å„ªå…ˆåº¦ã®é©åˆ‡ãªè¨­å®š
- [ ] å‚è€ƒæ–‡çŒ®ã®æ˜è¨˜

---

## è³ªå•ãƒ»ã‚µãƒãƒ¼ãƒˆ

- **GitHub Discussions**: ä¸€èˆ¬çš„ãªè³ªå•
- **GitHub Issues**: ãƒã‚°å ±å‘Šãƒ»æ©Ÿèƒ½ææ¡ˆ
- **Email**: tenjin@example.com

è²¢çŒ®ã—ã¦ãã ã•ã‚‹ã™ã¹ã¦ã®æ–¹ã«æ„Ÿè¬ã—ã¾ã™ï¼ğŸ™
